<!-- uvnitř <div class="container"> -->
<h1>Docházkový systém</h1>
<input type="password" id="heslo" placeholder="Zadejte své 6místné heslo" required />
<select id="location" required>
  <option value="">-- Vyber místo --</option>
  <option>ZŠ Purkyňova Vyškov</option>
  <option>ZŠ Letní Pole Vyškov</option>
  <option>ZŠ Melantrichova Prostějov</option>
  <option>ZŠ TGM Blansko</option>
</select>
<button id="submit">Odeslat</button>
<div id="response"></div>
<div id="timestamp"></div>

<!-- Odkaz pro registraci -->
<a class="register-link" href="TVŮJ_REGISTRAČNÍ_ODKAZ" target="_blank">
  Nejsi zaregistrovaný?
</a>

<script>
  function getCurrentDateTimeString() {
    const now = new Date();
    const date = now.toLocaleDateString('cs-CZ');
    const time = now.toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' });
    return `Aktuální čas: ${date} ${time}`;
  }

  document.getElementById('timestamp').innerText = getCurrentDateTimeString();

  document.getElementById('submit').addEventListener('click', function () {
    const heslo = document.getElementById('heslo').value.trim();
    const location = document.getElementById('location').value;
    const response = document.getElementById('response');

    if (!heslo || !location) {
      response.style.color = '#ef4444';
      response.innerText = 'Vyplňte všechna pole.';
      return;
    }

    // Zavolání serveru pro ověření hesla
    google.script.run.withSuccessHandler(function(jmeno) {
      if (!jmeno) {
        response.style.color = '#ef4444';
        response.innerText = 'Neplatné heslo. Nejste zaregistrován.';
        return;
      }

      // Pokračuj v odeslání na Google Formulář
      const formData = new FormData();
      formData.append('entry.736433288', jmeno);      // Jméno
      formData.append('entry.685021946', location);   // Místo

      fetch('https://docs.google.com/forms/u/0/d/e/1FAIpQLSefMUVcf4PUCw1EhVrco_hzrCjrcRZ-GhJpWk05u12y_pXgpQ/formResponse', {
        method: 'POST',
        mode: 'no-cors',
        body: formData
      })
      .then(() => {
        response.style.color = '#10b981';
        response.innerText = 'Údaje byly úspěšně odeslány!';
        document.getElementById('timestamp').innerText = getCurrentDateTimeString();
        document.getElementById('heslo').value = '';
        document.getElementById('location').value = '';
      })
      .catch(error => {
        response.style.color = '#ef4444';
        response.innerText = 'Nastala chyba: ' + error.message;
      });

    }).ziskejJmenoZHesla(heslo);
  });
</script>
